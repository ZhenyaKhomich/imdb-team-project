import{t as c,v as g}from"./chunk-A4OJEWE2.js";import{C as r}from"./chunk-EQKMLW76.js";import{L as y,O as n,S as a,a as h,b as d,ja as T,kc as b,lc as l,sc as v}from"./chunk-U6YJBN55.js";var m=class p{signalService=a(c);http=a(l);addMovieWatchList(e){return this.http.post(r.api+"watchlist",{titleData:e})}getWatchList(){return this.http.get(r.api+"watchlist")}deleteWatchListElement(e){return this.http.delete(r.api+"watchlist"+"/"+e)}getMovies(){this.getWatchList().subscribe(e=>{this.signalService.watchlistData.set(e),e.titles?.forEach(t=>{this.signalService.idForCheckElementInWatchlist.set([...this.signalService.idForCheckElementInWatchlist(),t.id])})})}addMovie(e){let t=this.signalService.idForCheckElementInWatchlist();this.signalService.idForCheckElementInWatchlist.set([...t,e.id]),this.addMovieWatchList(e).subscribe(()=>{this.getMovies()})}deleteMovie(e){let t=this.signalService.idForCheckElementInWatchlist().filter(i=>i!==e);this.signalService.idForCheckElementInWatchlist.set(t),this.deleteWatchListElement(e).subscribe(i=>{i.error||this.getMovies()})}static \u0275fac=function(t){return new(t||p)};static \u0275prov=n({token:p,factory:p.\u0275fac,providedIn:"root"})};var u=class p{favoriteId=T([]);watchlistService=a(m);http=a(l);router=a(v);snakeBar=a(g);signalService=a(c);getTitles(e){let t=new b;return e&&Object.entries(e).forEach(([i,s])=>{Array.isArray(s)?s.forEach(o=>t=t.append(i,String(o))):t=t.set(i,String(s))}),this.http.get(r.baseUrl+"titles",{params:t})}getTitle(e){return this.http.get(r.baseUrl+"titles"+"/"+e)}getVideos(e){return this.http.get(r.baseUrl+"titles"+"/"+e+"/videos")}getCompanies(e){return this.http.get(r.baseUrl+"titles"+"/"+e+"/companyCredits")}getImages(e){return this.http.get(r.baseUrl+"titles"+"/"+e+"/images")}toggleFavorite(e,t){if(this.signalService.idForCheckElementInWatchlist().includes(e))this.watchlistService.deleteMovie(e);else{let i=t.find(s=>s.id===e);if(i&&"primaryTitle"in i){let s={id:i.id,type:i.type,primaryTitle:i.primaryTitle,primaryImage:i.primaryImage,startYear:i.startYear,endYear:i.endYear,runtimeSeconds:i.runtimeSeconds||0,genres:i.genres,rating:i.rating,plot:i.plot};this.watchlistService.addMovie(s)}}}searchTitles(e){return this.http.get(r.baseUrl+"search/titles?query="+e)}getTrailer(e){return this.http.get(r.baseUrl+"titles"+"/"+e+"/videos").pipe(y(t=>{t.videos||this.snakeBar.open("The trailer was not found","",{duration:4e3})}))}addRecentlyViewed(e){return this.http.post(r.api+"viewed",e)}getRecentlyViewed(){return this.http.get(r.api+"viewed")}deleteRecentlyViewed(){return this.http.delete(r.api+"viewed")}openMovieAndAddRecentlyViewed(e){this.router.navigate(["/movies",e.id]);let t=this.signalService.recentlyViewedVideos()?.titles;t?.find(s=>s.id===e.id)||(t&&t.length>30&&this.deleteRecentlyViewed().subscribe(),this.addRecentlyViewed({titleData:e}).subscribe(s=>{s.error||this.getRecentlyViewed().subscribe(o=>{this.signalService.recentlyViewedVideos.set(d(h({},o),{titles:o.titles?.reverse()}))})}))}static \u0275fac=function(t){return new(t||p)};static \u0275prov=n({token:p,factory:p.\u0275fac,providedIn:"root"})};export{m as a,u as b};
